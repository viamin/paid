#!/bin/sh
# Git credential helper that fetches credentials from the Paid secrets proxy.
#
# Used inside agent containers to authenticate git operations (clone, push)
# without exposing GitHub tokens in the container environment.
#
# Git calls this script with "get", "store", or "erase" as the first argument.
# We only respond to "get" requests.
#
# Required environment variables (set by Containers::Provision):
#   AGENT_RUN_ID  - The agent run identifier
#   PROXY_TOKEN   - Authentication token for the secrets proxy
#   PAID_PROXY_URL - Base URL of the secrets proxy (e.g. http://paid-proxy:3000)

case "$1" in
  get)
    exec curl -sf \
      -H "X-Agent-Run-Id: ${AGENT_RUN_ID}" \
      -H "X-Proxy-Token: ${PROXY_TOKEN}" \
      "${PAID_PROXY_URL}/api/proxy/git-credentials"
    ;;
  *)
    exit 0
    ;;
esac
