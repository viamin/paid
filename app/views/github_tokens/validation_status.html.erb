<%= turbo_frame_tag "validation-status" do %>
  <% if @github_token.validation_stale? %>
    <div class="border-t border-gray-200 bg-yellow-50 px-4 py-4 sm:px-6">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495ZM10 5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 5Zm0 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-yellow-800">Validation appears stuck</h3>
          <p class="mt-1 text-sm text-yellow-700">
            Validation has not completed. This can happen if the background process was interrupted.
          </p>
          <div class="mt-3">
            <%= button_to "Retry Validation",
                retry_validation_github_token_path(@github_token),
                method: :post,
                class: "rounded-md bg-yellow-100 px-3 py-1.5 text-sm font-medium text-yellow-800 hover:bg-yellow-200" %>
          </div>
        </div>
      </div>
    </div>

  <% elsif @github_token.validation_pending? || @github_token.validating? %>
    <div class="border-t border-gray-200 bg-blue-50 px-4 py-4 sm:px-6">
      <div class="flex items-center">
        <svg class="animate-spin h-5 w-5 text-blue-600 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <div>
          <h3 class="text-sm font-medium text-blue-800">Validating token with GitHub...</h3>
          <p class="mt-1 text-sm text-blue-700">
            Checking credentials and syncing accessible repositories. This may take a moment.
          </p>
        </div>
      </div>
    </div>

    <script>
      (function() {
        setTimeout(function() {
          var frame = document.getElementById("validation-status");
          if (frame) {
            if (typeof frame.reload === "function") {
              frame.reload();
            } else if (frame.src) {
              frame.src = frame.src;
            }
          }
        }, 2000);
      })();
    </script>

  <% elsif @github_token.validation_failed? %>
    <div class="border-t border-gray-200 bg-red-50 px-4 py-4 sm:px-6">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16ZM8.28 7.22a.75.75 0 0 0-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 1 0 1.06 1.06L10 11.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L11.06 10l1.72-1.72a.75.75 0 0 0-1.06-1.06L10 8.94 8.28 7.22Z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-red-800">Validation Failed</h3>
          <p class="mt-1 text-sm text-red-700"><%= @github_token.validation_error %></p>
          <div class="mt-3">
            <%= button_to "Retry Validation",
                retry_validation_github_token_path(@github_token),
                method: :post,
                class: "rounded-md bg-red-100 px-3 py-1.5 text-sm font-medium text-red-800 hover:bg-red-200" %>
          </div>
        </div>
      </div>
    </div>

  <% elsif @github_token.validated? %>
    <div class="border-t border-gray-200 bg-green-50 px-4 py-4 sm:px-6">
      <div class="flex items-center">
        <svg class="h-5 w-5 text-green-400 mr-3" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" />
        </svg>
        <div>
          <h3 class="text-sm font-medium text-green-800">Token validated successfully</h3>
          <p class="mt-1 text-sm text-green-700">
            Found <%= pluralize(@github_token.accessible_repositories.size, "accessible repository", "accessible repositories") %>.
          </p>
        </div>
      </div>
    </div>
  <% end %>
<% end %>
