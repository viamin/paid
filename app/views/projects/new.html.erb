<% content_for(:title) { "Add Project - Paid" } %>

<div class="mx-auto max-w-3xl px-4 py-8 sm:px-6 lg:px-8">
  <div class="mb-6">
    <%= link_to projects_path, class: "inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700" do %>
      <svg class="mr-1 h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M17 10a.75.75 0 0 1-.75.75H5.612l4.158 3.96a.75.75 0 1 1-1.04 1.08l-5.5-5.25a.75.75 0 0 1 0-1.08l5.5-5.25a.75.75 0 1 1 1.04 1.08L5.612 9.25H16.25A.75.75 0 0 1 17 10Z" clip-rule="evenodd" />
      </svg>
      Back to Projects
    <% end %>
  </div>

  <div class="bg-white shadow sm:rounded-lg">
    <div class="px-4 py-5 sm:p-6">
      <h1 class="text-xl font-semibold text-gray-900">Add Project</h1>
      <p class="mt-1 text-sm text-gray-500">
        Connect a GitHub repository to start using AI agents for development.
      </p>

      <% if @github_tokens.empty? %>
        <div class="mt-6 rounded-md bg-yellow-50 p-4">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495ZM10 5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 5Zm0 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="ml-3">
              <h3 class="text-sm font-medium text-yellow-800">No GitHub Tokens Available</h3>
              <div class="mt-2 text-sm text-yellow-700">
                <p>You need to add a GitHub token before you can add a project.</p>
              </div>
              <div class="mt-4">
                <%= link_to new_github_token_path, class: "text-sm font-medium text-yellow-800 underline hover:text-yellow-700" do %>
                  Add a GitHub Token
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% else %>
        <div class="mt-6 rounded-md bg-blue-50 p-4">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-7-4a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM9 9a.75.75 0 0 0 0 1.5h.253a.25.25 0 0 1 .244.304l-.459 2.066A1.75 1.75 0 0 0 10.747 15H11a.75.75 0 0 0 0-1.5h-.253a.25.25 0 0 1-.244-.304l.459-2.066A1.75 1.75 0 0 0 9.253 9H9Z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="ml-3">
              <h3 class="text-sm font-medium text-blue-800">Repository Access</h3>
              <div class="mt-2 text-sm text-blue-700">
                <p>The selected GitHub token must have access to the repository you want to add. Make sure the token has the required permissions for reading issues, creating branches, and opening pull requests.</p>
              </div>
            </div>
          </div>
        </div>

        <%= form_with model: @project, url: projects_path, class: "mt-6" do |form| %>
          <% if @project.errors.any? %>
            <div class="mb-6 rounded-md bg-red-50 p-4">
              <div class="flex">
                <div class="flex-shrink-0">
                  <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16ZM8.28 7.22a.75.75 0 0 0-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 1 0 1.06 1.06L10 11.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L11.06 10l1.72-1.72a.75.75 0 0 0-1.06-1.06L10 8.94 8.28 7.22Z" clip-rule="evenodd" />
                  </svg>
                </div>
                <div class="ml-3">
                  <h3 class="text-sm font-medium text-red-800">
                    <%= pluralize(@project.errors.count, "error") %> prevented this project from being saved:
                  </h3>
                  <div class="mt-2 text-sm text-red-700">
                    <ul class="list-disc space-y-1 pl-5">
                      <% @project.errors.full_messages.each do |message| %>
                        <li><%= message %></li>
                      <% end %>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          <% end %>

          <div class="space-y-6">
            <div>
              <%= form.label :github_token_id, "GitHub Token", class: "block text-sm font-medium leading-6 text-gray-900" %>
              <div class="mt-2">
                <%= form.select :github_token_id,
                    options_from_collection_for_select(@github_tokens, :id, :name, @project.github_token_id),
                    { prompt: "Select a token..." },
                    class: "block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" %>
              </div>
              <p class="mt-1 text-xs text-gray-500">Select the token that has access to this repository.</p>
            </div>

            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
              <div>
                <%= form.label :owner, "Repository Owner", class: "block text-sm font-medium leading-6 text-gray-900" %>
                <div class="mt-2">
                  <%= form.text_field :owner, class: "block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6", placeholder: "e.g., octocat", required: true %>
                </div>
                <p class="mt-1 text-xs text-gray-500">GitHub username or organization name.</p>
              </div>

              <div>
                <%= form.label :repo, "Repository Name", class: "block text-sm font-medium leading-6 text-gray-900" %>
                <div class="mt-2">
                  <%= form.text_field :repo, class: "block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6", placeholder: "e.g., hello-world", required: true %>
                </div>
                <p class="mt-1 text-xs text-gray-500">The name of the repository.</p>
              </div>
            </div>

            <div>
              <%= form.label :name, "Display Name (optional)", class: "block text-sm font-medium leading-6 text-gray-900" %>
              <div class="mt-2">
                <%= form.text_field :name, class: "block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6", placeholder: "e.g., My Project" %>
              </div>
              <p class="mt-1 text-xs text-gray-500">A friendly name for this project. Defaults to the repository name if not provided.</p>
            </div>
          </div>

          <div class="mt-6 flex items-center justify-end gap-x-4">
            <%= link_to "Cancel", projects_path, class: "text-sm font-semibold leading-6 text-gray-900 hover:text-gray-700" %>
            <%= form.submit "Add Project", class: "rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 cursor-pointer" %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
