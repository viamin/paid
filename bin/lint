#!/usr/bin/env bash
set -euo pipefail

RUBOCOP_ARGS=""
if [ "${GITHUB_ACTIONS:-}" = "true" ]; then
  RUBOCOP_ARGS="-f github"
fi

echo "== Style: RuboCop =="
bin/rubocop $RUBOCOP_ARGS

echo "== Security: Brakeman =="
bin/brakeman --quiet --no-pager --exit-on-warn --exit-on-error

echo "== Security: Gem audit =="
bin/bundler-audit

echo "== Security: Yarn audit =="
yarn audit

echo "== Markdown: markdownlint =="
npx markdownlint-cli2 '**/*.md' '#node_modules' '#vendor'

echo "All checks passed."
